<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frankenstein's Radio Laboratory</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: 'Special Elite', cursive;
            background-color: #0a0a0a;
            color: #00ff00;
        }
        #slideshow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            filter: sepia(50%) hue-rotate(50deg) saturate(150%);
        }
        #controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        #controls > div {
            margin: 10px 0;
        }
        #audioPlayer {
            display: none;
        }
        label {
            display: inline-block;
            width: 150px;
        }
        input[type="range"] {
            -webkit-appearance: none;
            width: 150px;
            height: 10px;
            background: #333;
            outline: none;
            border-radius: 5px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #00ff00;
            cursor: pointer;
            border-radius: 50%;
        }
        button {
            background-color: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 5px 10px;
            cursor: pointer;
            font-family: 'Special Elite', cursive;
        }
        button:hover {
            background-color: #00ff00;
            color: #333;
        }
        #visualizer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background-color: rgba(0, 0, 0, 0.5);
        }
        #title {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            text-align: center;
            text-shadow: 0 0 10px #00ff00;
        }
        #radio-crt {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 300px;
            background-color: #111;
            border-radius: 20px;
            border: 10px solid #333;
            box-shadow: 0 0 20px #00ff00;
            overflow: hidden;
        }
        #screen {
            width: 360px;
            height: 220px;
            margin: 20px auto;
            background-color: #001a00;
            border-radius: 50%/10%;
            position: relative;
            overflow: hidden;
        }
        #screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, 
                rgba(255,255,255,0) 50%, 
                rgba(0,255,0,0.1) 50%);
            background-size: 100% 4px;
            animation: scan 10s linear infinite;
        }
        @keyframes scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        #dial {
            width: 80px;
            height: 80px;
            background-color: #222;
            border-radius: 50%;
            position: absolute;
            bottom: 20px;
            left: 20px;
            border: 5px solid #444;
        }
        #dial::before {
            content: '';
            position: absolute;
            width: 5px;
            height: 40px;
            background-color: #00ff00;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -100%);
            transform-origin: bottom;
            animation: rotate 10s linear infinite;
        }
        @keyframes rotate {
            0% { transform: translate(-50%, -100%) rotate(0deg); }
            100% { transform: translate(-50%, -100%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="title">Frankenstein's Radio Laboratory</div>
    <div id="slideshow"></div>
    <canvas id="visualizer"></canvas>
    <div id="radio-crt">
        <div id="screen"></div>
        <div id="dial"></div>
    </div>
    <div id="controls">
        <div>
            <button id="playPause">Animate/Pause</button>
            <label for="volumeControl">Volume Flux:</label>
            <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.5">
        </div>
        <div>
            <label for="transitionSpeed">Time Warp (s):</label>
            <input type="range" id="transitionSpeed" min="1" max="10" step="0.5" value="5">
        </div>
        <div>
            <label for="soundChange">Sonic Transmutation:</label>
            <input type="checkbox" id="soundChange">
        </div>
    </div>
    <audio id="audioPlayer" loop>
        <source src="Frank Radio X.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        const slideshow = document.getElementById('slideshow');
        const audioPlayer = document.getElementById('audioPlayer');
        const playPauseBtn = document.getElementById('playPause');
        const volumeControl = document.getElementById('volumeControl');
        const transitionSpeed = document.getElementById('transitionSpeed');
        const soundChange = document.getElementById('soundChange');
        const visualizer = document.getElementById('visualizer');
        const visualCtx = visualizer.getContext('2d');

        let images = [];
        let currentImageIndex = 0;
        let transitionInterval;
        let audioContext, analyser, dataArray;

        // Fetch images from GitHub repository
        async function fetchImages() {
            const username = 'hartswf0';
            const repo = 'frankenstein-radio';
            const path = 'FM_RADIO_PNG'; 

            try {
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${path}`);
                const data = await response.json();
                images = data.filter(file => file.type === 'file' && /\.(jpe?g|png|gif)$/i.test(file.name))
                                .map(file => file.download_url);
                startSlideshow();
            } catch (error) {
                console.error('Error fetching images:', error);
            }
        }

        function startSlideshow() {
            if (images.length === 0) return;

            const img1 = new Image();
            const img2 = new Image();
            let activeImg = img1;
            let inactiveImg = img2;

            slideshow.appendChild(img1);
            slideshow.appendChild(img2);

            function transitionImages() {
                activeImg.style.opacity = 1;
                inactiveImg.style.opacity = 0;
                inactiveImg.style.transition = `opacity ${transitionSpeed.value}s ease-in-out`;
                inactiveImg.src = images[currentImageIndex];

                setTimeout(() => {
                    inactiveImg.style.opacity = 1;
                    [activeImg, inactiveImg] = [inactiveImg, activeImg];
                    currentImageIndex = (currentImageIndex + 1) % images.length;
                }, 50);
            }

            img1.onload = img2.onload = transitionImages;
            img1.src = images[currentImageIndex];
            currentImageIndex = (currentImageIndex + 1) % images.length;

            updateTransitionInterval();
        }

        function updateTransitionInterval() {
            clearInterval(transitionInterval);
            transitionInterval = setInterval(() => {
                if (!soundChange.checked) {
                    const event = new Event('transition');
                    slideshow.dispatchEvent(event);
                }
            }, transitionSpeed.value * 1000);
        }

        // Audio controls and analysis
        playPauseBtn.addEventListener('click', () => {
            if (audioPlayer.paused) {
                audioPlayer.play();
                setupAudioAnalysis();
            } else {
                audioPlayer.pause();
            }
        });

        volumeControl.addEventListener('input', (e) => {
            audioPlayer.volume = e.target.value;
        });

        transitionSpeed.addEventListener('input', updateTransitionInterval);

        function setupAudioAnalysis() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaElementSource(audioPlayer);
                source.connect(analyser);
                analyser.connect(audioContext.destination);

                analyser.fftSize = 256;
                const bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);

                function detectBeat() {
                    analyser.getByteFrequencyData(dataArray);
                    const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
                    if (average > 128 && soundChange.checked) {
                        const event = new Event('transition');
                        slideshow.dispatchEvent(event);
                    }
                    requestAnimationFrame(detectBeat);
                }

                detectBeat();
                visualize();
            }
        }

        function visualize() {
            visualizer.width = window.innerWidth;
            visualizer.height = 100;

            function draw() {
                requestAnimationFrame(draw);

                analyser.getByteFrequencyData(dataArray);

                visualCtx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                visualCtx.fillRect(0, 0, visualizer.width, visualizer.height);

                const barWidth = (visualizer.width / dataArray.length) * 2.5;
                let x = 0;

                for (let i = 0; i < dataArray.length; i++) {
                    const barHeight = dataArray[i] / 2;

                    visualCtx.fillStyle = `rgb(0, ${Math.floor(barHeight + 100)}, 0)`;
                    visualCtx.fillRect(x, visualizer.height - barHeight, barWidth, barHeight);

                    x += barWidth + 1;
                }
            }

            draw();
        }

        slideshow.addEventListener('transition', () => {
            const event = new Event('click');
            playPauseBtn.dispatchEvent(event);
        });

        // Initialize
        fetchImages();

        // Resize event listener
        window.addEventListener('resize', () => {
            if (visualizer.width !== window.innerWidth) {
                visualizer.width = window.innerWidth;
            }
        });
    </script>
</body>
</html>